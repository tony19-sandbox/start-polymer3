import{PropertyAccessors}from"./property-accessors.js";import{dedupingMixin}from"../utils/mixin.js";const HOST_DIR=/:host\(:dir\((ltr|rtl)\)\)/g,HOST_DIR_REPLACMENT=":host([dir=\"$1\"])",EL_DIR=/([\s\w-#\.\[\]\*]*):dir\((ltr|rtl)\)/g,EL_DIR_REPLACMENT=":host([dir=\"$2\"]) $1",DIR_INSTANCES=[];let observer=null,DOCUMENT_DIR="";function getRTL(){DOCUMENT_DIR=document.documentElement.getAttribute("dir")}function setRTL(a){if(!a.__autoDirOptOut){a.setAttribute("dir",DOCUMENT_DIR)}}function updateDirection(){getRTL(),DOCUMENT_DIR=document.documentElement.getAttribute("dir");for(let a=0;a<DIR_INSTANCES.length;a++)setRTL(DIR_INSTANCES[a])}function takeRecords(){observer&&observer.takeRecords().length&&updateDirection()}export const DirMixin=dedupingMixin(a=>{observer||(getRTL(),observer=new MutationObserver(updateDirection),observer.observe(document.documentElement,{attributes:!0,attributeFilter:["dir"]}));const b=PropertyAccessors(a);class c extends b{static _processStyleText(a,b){return a=super._processStyleText(a,b),a=this._replaceDirInCssText(a),a}static _replaceDirInCssText(a){let b=a;return b=b.replace(HOST_DIR,HOST_DIR_REPLACMENT),b=b.replace(EL_DIR,EL_DIR_REPLACMENT),a!==b&&(this.__activateDir=!0),b}constructor(){super(),this.__autoDirOptOut=!1}ready(){super.ready(),this.__autoDirOptOut=this.hasAttribute("dir")}connectedCallback(){b.prototype.connectedCallback&&super.connectedCallback(),this.constructor.__activateDir&&(takeRecords(),DIR_INSTANCES.push(this),setRTL(this))}disconnectedCallback(){if(b.prototype.disconnectedCallback&&super.disconnectedCallback(),this.constructor.__activateDir){const a=DIR_INSTANCES.indexOf(this);-1<a&&DIR_INSTANCES.splice(a,1)}}}return c.__activateDir=!1,c});