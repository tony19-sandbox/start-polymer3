import"../utils/boot.js";import{dedupingMixin}from"../utils/mixin.js";import{root as root$0,isAncestor,isDescendant,get as get$0,translate,isPath as isPath$0,set as set$0,normalize}from"../utils/path.js";import*as caseMap from"../utils/case-map.js";import{camelToDashCase as camelToDashCase$0,dashToCamelCase}from"../utils/case-map.js";import{PropertyAccessors}from"./property-accessors.js";import{TemplateStamp}from"./template-stamp.js";import{sanitizeDOMValue}from"../utils/settings.js";const CaseMap=caseMap;let dedupeId=0;const TYPES={COMPUTE:"__computeEffects",REFLECT:"__reflectEffects",NOTIFY:"__notifyEffects",PROPAGATE:"__propagateEffects",OBSERVE:"__observeEffects",READ_ONLY:"__readOnly"},capitalAttributeRegex=/[A-Z]/;let DataTrigger,DataEffect,PropertyEffectsType;function ensureOwnEffectMap(e,t){let a=e[t];if(!a)a=e[t]={};else if(!e.hasOwnProperty(t))for(let r in a=e[t]=Object.create(e[t]),a){let e=a[r],t=a[r]=Array(e.length);for(let a=0;a<e.length;a++)t[a]=e[a]}return a}function runEffects(e,t,a,r,n,d){if(t){let o=!1,i=dedupeId++;for(let s in a)runEffectsForProperty(e,t,i,s,a,r,n,d)&&(o=!0);return o}return!1}function runEffectsForProperty(e,t,a,r,n,d,o,s){let p=!1,i=o?root$0(r):r,_=t[i];if(_)for(let t,f=0,i=_.length;f<i&&(t=_[f]);f++)t.info&&t.info.lastRun===a||o&&!pathMatchesTrigger(r,t.trigger)||(t.info&&(t.info.lastRun=a),t.fn(e,r,n,d,t.info,o,s),p=!0);return p}function pathMatchesTrigger(e,t){if(t){let a=t.name;return a==e||t.structured&&isAncestor(a,e)||t.wildcard&&isDescendant(a,e)}return!0}function runObserverEffect(e,t,a,r,n){let d="string"===typeof n.method?e[n.method]:n.method,o=n.property;d?d.call(e,e.__data[o],r[o]):!n.dynamicFn&&console.warn("observer method `"+n.method+"` not defined")}function runNotifyEffects(e,t,a,r,n){let d,o=e[TYPES.NOTIFY],i=dedupeId++;for(let s in t)t[s]&&(o&&runEffectsForProperty(e,o,i,s,a,r,n)?d=!0:n&&notifyPath(e,s,a)&&(d=!0));let s;d&&(s=e.__dataHost)&&s._invalidateProperties&&s._invalidateProperties()}function notifyPath(e,t,a){let r=root$0(t);if(r!==t){let n=camelToDashCase$0(r)+"-changed";return dispatchNotifyEvent(e,n,a[t],t),!0}return!1}function dispatchNotifyEvent(e,t,a,r){let n={value:a,queueProperty:!0};r&&(n.path=r),e.dispatchEvent(new CustomEvent(t,{detail:n}))}function runNotifyEffect(e,t,a,r,n,d){let o=d?root$0(t):t,i=o==t?null:t,s=i?get$0(e,i):e.__data[t];i&&s===void 0&&(s=a[t]),dispatchNotifyEvent(e,n.eventName,s,i)}function handleNotification(e,t,a,r,n){let d,o=e.detail,i=o&&o.path;i?(r=translate(a,r,i),d=o&&o.value):d=e.target[a],d=n?!d:d,t[TYPES.READ_ONLY]&&t[TYPES.READ_ONLY][r]||!t._setPendingPropertyOrPath(r,d,!0,!!i)||o&&o.queueProperty||t._invalidateProperties()}function runReflectEffect(e,t,a,r,n){let d=e.__data[t];sanitizeDOMValue&&(d=sanitizeDOMValue(d,n.attrName,"attribute",e)),e._propertyToAttribute(t,n.attrName,d)}function runComputedEffects(e,t,a,r){let n=e[TYPES.COMPUTE];if(n)for(let d=t;runEffects(e,n,d,a,r);)Object.assign(a,e.__dataOld),Object.assign(t,e.__dataPending),d=e.__dataPending,e.__dataPending=null}function runComputedEffect(e,t,a,r,n){let d=runMethodEffect(e,t,a,r,n),o=n.methodInfo;e.__dataHasAccessor&&e.__dataHasAccessor[o]?e._setPendingProperty(o,d,!0):e[o]=d}function computeLinkedPaths(e,t,r){let n=e.__dataLinkedPaths;if(n){let d;for(let o in n){let a=n[o];isDescendant(o,t)?(d=translate(o,a,t),e._setPendingPropertyOrPath(d,r,!0,!0)):isDescendant(a,t)&&(d=translate(a,o,t),e._setPendingPropertyOrPath(d,r,!0,!0))}}}function addBinding(e,t,a,r,n,d,o){a.bindings=a.bindings||[];let s={kind:r,target:n,parts:d,literal:o,isCompound:1!==d.length};if(a.bindings.push(s),shouldAddListener(s)){let{event:e,negate:t}=s.parts[0];s.listenerEvent=e||CaseMap.camelToDashCase(n)+"-changed",s.listenerNegate=t}let p=t.nodeInfoList.length;for(let _,l=0;l<s.parts.length;l++)_=s.parts[l],_.compoundIndex=l,addEffectForBindingPart(e,t,s,_,p)}function addEffectForBindingPart(e,t,a,r,n){if(!r.literal)if("attribute"===a.kind&&"-"===a.target[0])console.warn("Cannot set attribute "+a.target+" because \"-\" is not a valid attribute starting character");else{let d=r.dependencies,o={index:n,binding:a,part:r,evaluator:e};for(let a,r=0;r<d.length;r++)a=d[r],"string"==typeof a&&(a=parseArg(a),a.wildcard=!0),e._addTemplatePropertyEffect(t,a.rootProperty,{fn:runBindingEffect,info:o,trigger:a})}}function runBindingEffect(e,t,a,r,n,d,o){let i=o[n.index],s=n.binding,p=n.part;if(d&&p.source&&t.length>p.source.length&&"property"==s.kind&&!s.isCompound&&i.__isPropertyEffectsClient&&i.__dataHasAccessor&&i.__dataHasAccessor[s.target]){let r=a[t];t=translate(p.source,s.target,t),i._setPendingPropertyOrPath(t,r,!1,!0)&&e._enqueueClient(i)}else{let o=n.evaluator._evaluateBinding(e,p,t,a,r,d);applyBindingValue(e,i,s,p,o)}}function applyBindingValue(e,t,a,r,n){if(n=computeBindingValue(t,n,a,r),sanitizeDOMValue&&(n=sanitizeDOMValue(n,a.target,a.kind,t)),"attribute"==a.kind)e._valueToNodeAttribute(t,n,a.target);else{let r=a.target;t.__isPropertyEffectsClient&&t.__dataHasAccessor&&t.__dataHasAccessor[r]?(!t[TYPES.READ_ONLY]||!t[TYPES.READ_ONLY][r])&&t._setPendingProperty(r,n)&&e._enqueueClient(t):e._setUnmanagedPropertyToNode(t,r,n)}}function computeBindingValue(e,t,a,r){if(a.isCompound){let n=e.__dataCompoundStorage[a.target];n[r.compoundIndex]=t,t=n.join("")}return"attribute"!==a.kind&&("textContent"===a.target||"value"===a.target&&("input"===e.localName||"textarea"===e.localName))&&(t=void 0==t?"":t),t}function shouldAddListener(e){return!!e.target&&"attribute"!=e.kind&&"text"!=e.kind&&!e.isCompound&&"{"===e.parts[0].mode}function setupBindings(e,t){let{nodeList:a,nodeInfoList:r}=t;if(r.length)for(let t=0;t<r.length;t++){let n=r[t],d=a[t],o=n.bindings;if(o)for(let t,a=0;a<o.length;a++)t=o[a],setupCompoundStorage(d,t),addNotifyListener(d,e,t);d.__dataHost=e}}function setupCompoundStorage(e,t){if(t.isCompound){let a=e.__dataCompoundStorage||(e.__dataCompoundStorage={}),r=t.parts,n=Array(r.length);for(let e=0;e<r.length;e++)n[e]=r[e].literal;let d=t.target;a[d]=n,t.literal&&"property"==t.kind&&(e[d]=t.literal)}}function addNotifyListener(e,t,a){if(a.listenerEvent){let r=a.parts[0];e.addEventListener(a.listenerEvent,function(n){handleNotification(n,t,a.target,r.source,r.negate)})}}function createMethodEffect(e,t,a,r,n,d){d=t.static||d&&("object"!==typeof d||d[t.methodName]);let o={methodName:t.methodName,args:t.args,methodInfo:n,dynamicFn:d};for(let s,p=0;p<t.args.length&&(s=t.args[p]);p++)s.literal||e._addPropertyEffect(s.rootProperty,a,{fn:r,info:o,trigger:s});d&&e._addPropertyEffect(t.methodName,a,{fn:r,info:o})}function runMethodEffect(e,t,a,r,n){let d=e._methodHost||e,o=d[n.methodName];if(o){let r=marshalArgs(e.__data,n.args,t,a);return o.apply(d,r)}n.dynamicFn||console.warn("method `"+n.methodName+"` not defined")}const emptyArray=[],IDENT="(?:[a-zA-Z_$][\\w.:$\\-*]*)",NUMBER="(?:[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)",SQUOTE_STRING="(?:'(?:[^'\\\\]|\\\\.)*')",DQUOTE_STRING="(?:\"(?:[^\"\\\\]|\\\\.)*\")",STRING="(?:"+SQUOTE_STRING+"|"+DQUOTE_STRING+")",ARGUMENT="(?:("+IDENT+"|"+NUMBER+"|"+STRING+")\\s*)",ARGUMENTS="(?:"+ARGUMENT+"(?:,\\s*"+ARGUMENT+")*)",ARGUMENT_LIST="(?:\\(\\s*(?:"+ARGUMENTS+"?)\\)\\s*)",BINDING="("+IDENT+"\\s*"+ARGUMENT_LIST+"?)",OPEN_BRACKET="(\\[\\[|{{)\\s*",CLOSE_BRACKET="(?:]]|}})",NEGATE="(?:(!)\\s*)?",EXPRESSION=OPEN_BRACKET+NEGATE+BINDING+CLOSE_BRACKET,bindingRegex=new RegExp(EXPRESSION,"g");function literalFromParts(e){let t="";for(let a,r=0;r<e.length;r++)a=e[r].literal,t+=a||"";return t}function parseMethod(e){let t=e.match(/([^\s]+?)\(([\s\S]*)\)/);if(t){let e=t[1],a={methodName:e,static:!0,args:emptyArray};if(t[2].trim()){let e=t[2].replace(/\\,/g,"&comma;").split(",");return parseArgs(e,a)}return a}return null}function parseArgs(e,t){return t.args=e.map(function(e){let a=parseArg(e);return a.literal||(t.static=!1),a},this),t}function parseArg(e){let t=e.trim().replace(/&comma;/g,",").replace(/\\(.)/g,"$1"),r={name:t,value:"",literal:!1},a=t[0];return"-"===a&&(a=t[1]),"0"<=a&&"9">=a&&(a="#"),"'"===a||"\""===a?(r.value=t.slice(1,-1),r.literal=!0):"#"===a?(r.value=+t,r.literal=!0):void 0,(r.literal||(r.rootProperty=root$0(t),r.structured=isPath$0(t),r.structured&&(r.wildcard=".*"==t.slice(-2),r.wildcard&&(r.name=t.slice(0,-2)))),r)}function marshalArgs(e,t,a,r){let n=[];for(let d=0,o=t.length;d<o;d++){let o,i=t[d],s=i.name;if(i.literal?o=i.value:i.structured?(o=get$0(e,s),void 0===o&&(o=r[s])):o=e[s],i.wildcard){let e=0===s.indexOf(a+"."),t=0===a.indexOf(s)&&!e;n[d]={path:t?a:s,value:t?r[a]:o,base:o}}else n[d]=o}return n}function notifySplices(e,t,a,r){let n=a+".splices";e.notifyPath(n,{indexSplices:r}),e.notifyPath(a+".length",t.length),e.__data[n]={indexSplices:null}}function notifySplice(e,t,a,r,n,d){notifySplices(e,t,a,[{index:r,addedCount:n,removed:d,object:t,type:"splice"}])}function upper(e){return e[0].toUpperCase()+e.substring(1)}export const PropertyEffects=dedupingMixin(e=>{const t=TemplateStamp(PropertyAccessors(e));class a extends t{constructor(){super(),this.__isPropertyEffectsClient=!0,this.__dataCounter=0,this.__dataClientsReady,this.__dataPendingClients,this.__dataToNotify,this.__dataLinkedPaths,this.__dataHasPaths,this.__dataCompoundStorage,this.__dataHost,this.__dataTemp,this.__dataClientsInitialized,this.__data,this.__dataPending,this.__dataOld,this.__computeEffects,this.__reflectEffects,this.__notifyEffects,this.__propagateEffects,this.__observeEffects,this.__readOnly,this.__templateInfo}get PROPERTY_EFFECT_TYPES(){return TYPES}_initializeProperties(){super._initializeProperties(),hostStack.registerHost(this),this.__dataClientsReady=!1,this.__dataPendingClients=null,this.__dataToNotify=null,this.__dataLinkedPaths=null,this.__dataHasPaths=!1,this.__dataCompoundStorage=this.__dataCompoundStorage||null,this.__dataHost=this.__dataHost||null,this.__dataTemp={},this.__dataClientsInitialized=!1}_initializeProtoProperties(e){this.__data=Object.create(e),this.__dataPending=Object.create(e),this.__dataOld={}}_initializeInstanceProperties(e){let t=this[TYPES.READ_ONLY];for(let a in e)t&&t[a]||(this.__dataPending=this.__dataPending||{},this.__dataOld=this.__dataOld||{},this.__data[a]=this.__dataPending[a]=e[a])}_addPropertyEffect(e,t,a){this._createPropertyAccessor(e,t==TYPES.READ_ONLY);let r=ensureOwnEffectMap(this,t)[e];r||(r=this[t][e]=[]),r.push(a)}_removePropertyEffect(e,t,a){let r=ensureOwnEffectMap(this,t)[e],n=r.indexOf(a);0<=n&&r.splice(n,1)}_hasPropertyEffect(e,t){let a=this[t];return!!(a&&a[e])}_hasReadOnlyEffect(e){return this._hasPropertyEffect(e,TYPES.READ_ONLY)}_hasNotifyEffect(e){return this._hasPropertyEffect(e,TYPES.NOTIFY)}_hasReflectEffect(e){return this._hasPropertyEffect(e,TYPES.REFLECT)}_hasComputedEffect(e){return this._hasPropertyEffect(e,TYPES.COMPUTE)}_setPendingPropertyOrPath(e,t,a,r){if(r||root$0(Array.isArray(e)?e[0]:e)!==e){if(!r){let a=get$0(this,e);if(e=set$0(this,e,t),!e||!super._shouldPropertyChange(e,t,a))return!1}if(this.__dataHasPaths=!0,this._setPendingProperty(e,t,a))return computeLinkedPaths(this,e,t),!0}else{if(this.__dataHasAccessor&&this.__dataHasAccessor[e])return this._setPendingProperty(e,t,a);this[e]=t}return!1}_setUnmanagedPropertyToNode(e,t,a){(a!==e[t]||"object"==typeof a)&&(e[t]=a)}_setPendingProperty(e,t,a){let r=this.__dataHasPaths&&isPath$0(e),n=r?this.__dataTemp:this.__data;return!!this._shouldPropertyChange(e,t,n[e])&&(this.__dataPending||(this.__dataPending={},this.__dataOld={}),e in this.__dataOld||(this.__dataOld[e]=this.__data[e]),r?this.__dataTemp[e]=t:this.__data[e]=t,this.__dataPending[e]=t,(r||this[TYPES.NOTIFY]&&this[TYPES.NOTIFY][e])&&(this.__dataToNotify=this.__dataToNotify||{},this.__dataToNotify[e]=a),!0)}_setProperty(e,t){this._setPendingProperty(e,t,!0)&&this._invalidateProperties()}_invalidateProperties(){this.__dataReady&&this._flushProperties()}_enqueueClient(e){this.__dataPendingClients=this.__dataPendingClients||[],e!==this&&this.__dataPendingClients.push(e)}_flushProperties(){this.__dataCounter++,super._flushProperties(),this.__dataCounter--}_flushClients(){this.__dataClientsReady?this.__enableOrFlushClients():(this.__dataClientsReady=!0,this._readyClients(),this.__dataReady=!0)}__enableOrFlushClients(){let e=this.__dataPendingClients;if(e){this.__dataPendingClients=null;for(let t,a=0;a<e.length;a++)t=e[a],t.__dataEnabled?t.__dataPending&&t._flushProperties():t._enableProperties()}}_readyClients(){this.__enableOrFlushClients()}setProperties(e,t){for(let a in e)!t&&this[TYPES.READ_ONLY]&&this[TYPES.READ_ONLY][a]||this._setPendingPropertyOrPath(a,e[a],!0);this._invalidateProperties()}ready(){this._flushProperties(),this.__dataClientsReady||this._flushClients(),this.__dataPending&&this._flushProperties()}_propertiesChanged(e,t,a){let r=this.__dataHasPaths;this.__dataHasPaths=!1,runComputedEffects(this,t,a,r);let n=this.__dataToNotify;this.__dataToNotify=null,this._propagatePropertyChanges(t,a,r),this._flushClients(),runEffects(this,this[TYPES.REFLECT],t,a,r),runEffects(this,this[TYPES.OBSERVE],t,a,r),n&&runNotifyEffects(this,n,t,a,r),1==this.__dataCounter&&(this.__dataTemp={})}_propagatePropertyChanges(e,t,a){this[TYPES.PROPAGATE]&&runEffects(this,this[TYPES.PROPAGATE],e,t,a);for(let r=this.__templateInfo;r;)runEffects(this,r.propertyEffects,e,t,a,r.nodeList),r=r.nextTemplateInfo}linkPaths(e,t){e=normalize(e),t=normalize(t),this.__dataLinkedPaths=this.__dataLinkedPaths||{},this.__dataLinkedPaths[e]=t}unlinkPaths(e){e=normalize(e),this.__dataLinkedPaths&&delete this.__dataLinkedPaths[e]}notifySplices(e,t){let a={path:""},r=get$0(this,e,a);notifySplices(this,r,a.path,t)}get(e,t){return get$0(t||this,e)}set(e,t,a){a?set$0(a,e,t):(!this[TYPES.READ_ONLY]||!this[TYPES.READ_ONLY][e])&&this._setPendingPropertyOrPath(e,t,!0)&&this._invalidateProperties()}push(e,...t){let a={path:""},r=get$0(this,e,a),n=r.length,d=r.push(...t);return t.length&&notifySplice(this,r,a.path,n,t.length,[]),d}pop(e){let t={path:""},a=get$0(this,e,t),r=!!a.length,n=a.pop();return r&&notifySplice(this,a,t.path,a.length,0,[n]),n}splice(e,t,a,...r){var n=Math.floor;let d={path:""},o=get$0(this,e,d);0>t?t=o.length-n(-t):t&&(t=n(t));let i;return i=2===arguments.length?o.splice(t):o.splice(t,a,...r),(r.length||i.length)&&notifySplice(this,o,d.path,t,r.length,i),i}shift(e){let t={path:""},a=get$0(this,e,t),r=!!a.length,n=a.shift();return r&&notifySplice(this,a,t.path,0,0,[n]),n}unshift(e,...t){let a={path:""},r=get$0(this,e,a),n=r.unshift(...t);return t.length&&notifySplice(this,r,a.path,0,t.length,[]),n}notifyPath(e,t){let a;if(1==arguments.length){let r={path:""};t=get$0(this,e,r),a=r.path}else a=Array.isArray(e)?normalize(e):e;this._setPendingPropertyOrPath(a,t,!0,!0)&&this._invalidateProperties()}_createReadOnlyProperty(e,t){this._addPropertyEffect(e,TYPES.READ_ONLY),t&&(this["_set"+upper(e)]=function(t){this._setProperty(e,t)})}_createPropertyObserver(e,t,a){let r={property:e,method:t,dynamicFn:!!a};this._addPropertyEffect(e,TYPES.OBSERVE,{fn:runObserverEffect,info:r,trigger:{name:e}}),a&&this._addPropertyEffect(t,TYPES.OBSERVE,{fn:runObserverEffect,info:r,trigger:{name:t}})}_createMethodObserver(e,t){let a=parseMethod(e);if(!a)throw new Error("Malformed observer expression '"+e+"'");createMethodEffect(this,a,TYPES.OBSERVE,runMethodEffect,null,t)}_createNotifyingProperty(e){this._addPropertyEffect(e,TYPES.NOTIFY,{fn:runNotifyEffect,info:{eventName:CaseMap.camelToDashCase(e)+"-changed",property:e}})}_createReflectedProperty(e){let t=this.constructor.attributeNameForProperty(e);"-"===t[0]?console.warn("Property "+e+" cannot be reflected to attribute "+t+" because \"-\" is not a valid starting attribute name. Use a lowercase first letter for the property instead."):this._addPropertyEffect(e,TYPES.REFLECT,{fn:runReflectEffect,info:{attrName:t}})}_createComputedProperty(e,t,a){let r=parseMethod(t);if(!r)throw new Error("Malformed computed expression '"+t+"'");createMethodEffect(this,r,TYPES.COMPUTE,runComputedEffect,e,a)}static addPropertyEffect(e,t,a){this.prototype._addPropertyEffect(e,t,a)}static createPropertyObserver(e,t,a){this.prototype._createPropertyObserver(e,t,a)}static createMethodObserver(e,t){this.prototype._createMethodObserver(e,t)}static createNotifyingProperty(e){this.prototype._createNotifyingProperty(e)}static createReadOnlyProperty(e,t){this.prototype._createReadOnlyProperty(e,t)}static createReflectedProperty(e){this.prototype._createReflectedProperty(e)}static createComputedProperty(e,t,a){this.prototype._createComputedProperty(e,t,a)}static bindTemplate(e){return this.prototype._bindTemplate(e)}_bindTemplate(e,t){let a=this.constructor._parseTemplate(e),r=this.__templateInfo==a;if(!r)for(let e in a.propertyEffects)this._createPropertyAccessor(e);if(t&&(a=Object.create(a),a.wasPreBound=r,!r&&this.__templateInfo)){let e=this.__templateInfoLast||this.__templateInfo;return this.__templateInfoLast=e.nextTemplateInfo=a,a.previousTemplateInfo=e,a}return this.__templateInfo=a}static _addTemplatePropertyEffect(e,t,a){let r=e.hostProps=e.hostProps||{};r[t]=!0;let n=e.propertyEffects=e.propertyEffects||{},d=n[t]=n[t]||[];d.push(a)}_stampTemplate(e){hostStack.beginHosting(this);let t=super._stampTemplate(e);hostStack.endHosting(this);let a=this._bindTemplate(e,!0);if(a.nodeList=t.nodeList,!a.wasPreBound){let e=a.childNodes=[];for(let a=t.firstChild;a;a=a.nextSibling)e.push(a)}return t.templateInfo=a,setupBindings(this,a),this.__dataReady&&runEffects(this,a.propertyEffects,this.__data,null,!1,a.nodeList),t}_removeBoundDom(e){let t=e.templateInfo;t.previousTemplateInfo&&(t.previousTemplateInfo.nextTemplateInfo=t.nextTemplateInfo),t.nextTemplateInfo&&(t.nextTemplateInfo.previousTemplateInfo=t.previousTemplateInfo),this.__templateInfoLast==t&&(this.__templateInfoLast=t.previousTemplateInfo),t.previousTemplateInfo=t.nextTemplateInfo=null;let a=t.childNodes;for(let t,r=0;r<a.length;r++)t=a[r],t.parentNode.removeChild(t)}static _parseTemplateNode(e,t,a){let r=super._parseTemplateNode(e,t,a);if(e.nodeType===Node.TEXT_NODE){let n=this._parseBindings(e.textContent,t);n&&(e.textContent=literalFromParts(n)||" ",addBinding(this,t,a,"text","textContent",n),r=!0)}return r}static _parseTemplateNodeAttribute(e,t,a,r,n){let d=this._parseBindings(n,t);if(d){let n=r,o="property";capitalAttributeRegex.test(r)?o="attribute":"$"==r[r.length-1]&&(r=r.slice(0,-1),o="attribute");let i=literalFromParts(d);return i&&"attribute"==o&&e.setAttribute(r,i),"input"===e.localName&&"value"===n&&e.setAttribute(n,""),e.removeAttribute(n),"property"===o&&(r=dashToCamelCase(r)),addBinding(this,t,a,o,r,d,i),!0}return super._parseTemplateNodeAttribute(e,t,a,r,n)}static _parseTemplateNestedTemplate(e,t,a){let r=super._parseTemplateNestedTemplate(e,t,a),n=a.templateInfo.hostProps;for(let r in n){addBinding(this,t,a,"property","_host_"+r,[{mode:"{",source:r,dependencies:[r]}])}return r}static _parseBindings(e,t){let a,r=[],n=0;for(;null!==(a=bindingRegex.exec(e));){a.index>n&&r.push({literal:e.slice(n,a.index)});let d=a[1][0],o=!!a[2],i=a[3].trim(),s=!1,p="",_=-1;"{"==d&&0<(_=i.indexOf("::"))&&(p=i.substring(_+2),i=i.substring(0,_),s=!0);let l=parseMethod(i),f=[];if(l){let{args:e,methodName:a}=l;for(let t,a=0;a<e.length;a++)t=e[a],t.literal||f.push(t);let r=t.dynamicFns;(r&&r[a]||l.static)&&(f.push(a),l.dynamicFn=!0)}else f.push(i);r.push({source:i,mode:d,negate:o,customEvent:s,signature:l,dependencies:f,event:p}),n=bindingRegex.lastIndex}if(n&&n<e.length){let t=e.substring(n);t&&r.push({literal:t})}return r.length?r:null}static _evaluateBinding(e,t,a,r,n,d){let o;return o=t.signature?runMethodEffect(e,a,r,n,t.signature):a==t.source?d&&isPath$0(a)?get$0(e,a):e.__data[a]:get$0(e,t.source),t.negate&&(o=!o),o}}return PropertyEffectsType=a,a});let hostStack={stack:[],registerHost(e){if(this.stack.length){let t=this.stack[this.stack.length-1];t._enqueueClient(e)}},beginHosting(e){this.stack.push(e)},endHosting(e){let t=this.stack.length;t&&this.stack[t-1]==e&&this.stack.pop()}};