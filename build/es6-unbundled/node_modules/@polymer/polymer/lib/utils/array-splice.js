import"./boot.js";function newSplice(a,b,c){return{index:a,removed:b,addedCount:c}}const EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;function calcEditDistances(a,b,c,d,e,f){let g=f-e+1,h=c-b+1,k=Array(g);for(let j=0;j<g;j++)k[j]=Array(h),k[j][0]=j;for(let g=0;g<h;g++)k[0][g]=g;for(let l=1;l<g;l++)for(let c=1;c<h;c++)if(equals(a[b+c-1],d[e+l-1]))k[l][c]=k[l-1][c-1];else{let a=k[l-1][c]+1,b=k[l][c-1]+1;k[l][c]=a<b?a:b}return k}function spliceOperationsFromEditDistances(a){let b=a.length-1,c=a[0].length-1,d=a[b][c],e=[];for(;0<b||0<c;){if(0==b){e.push(EDIT_ADD),c--;continue}if(0==c){e.push(EDIT_DELETE),b--;continue}let f,g=a[b-1][c-1],h=a[b-1][c],i=a[b][c-1];f=h<i?h<g?h:g:i<g?i:g,f==g?(g==d?e.push(0):(e.push(EDIT_UPDATE),d=g),b--,c--):f==h?(e.push(EDIT_DELETE),b--,d=h):(e.push(EDIT_ADD),c--,d=i)}return e.reverse(),e}function calcSplices(a,b,c,d,e,f){let g,h=0,i=0,j=Math.min(c-b,f-e);if(0==b&&0==e&&(h=sharedPrefix(a,d,j)),c==a.length&&f==d.length&&(i=sharedSuffix(a,d,j-h)),b+=h,e+=h,c-=i,f-=i,0==c-b&&0==f-e)return[];if(b==c){for(g=newSplice(b,[],0);e<f;)g.removed.push(d[e++]);return[g]}if(e==f)return[newSplice(b,[],c-b)];let k=spliceOperationsFromEditDistances(calcEditDistances(a,b,c,d,e,f));g=void 0;let l=[],m=b,n=e;for(let h=0;h<k.length;h++)switch(k[h]){case 0:g&&(l.push(g),g=void 0),m++,n++;break;case EDIT_UPDATE:g||(g=newSplice(m,[],0)),g.addedCount++,m++,g.removed.push(d[n]),n++;break;case EDIT_ADD:g||(g=newSplice(m,[],0)),g.addedCount++,m++;break;case EDIT_DELETE:g||(g=newSplice(m,[],0)),g.removed.push(d[n]),n++;}return g&&l.push(g),l}function sharedPrefix(a,b,c){for(let d=0;d<c;d++)if(!equals(a[d],b[d]))return d;return c}function sharedSuffix(a,b,c){let d=a.length,e=b.length,f=0;for(;f<c&&equals(a[--d],b[--e]);)f++;return f}function calculateSplices(a,b){return calcSplices(a,0,a.length,b,0,b.length)}function equals(a,b){return a===b}export{calculateSplices};