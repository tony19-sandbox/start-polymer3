import"../polymer/polymer-legacy.js";var KEY_IDENTIFIER={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"},KEY_CODE={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"},MODIFIER_KEYS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"},KEY_CHAR=/[a-z0-9*]/,IDENT_CHAR=/U\+/,ARROW_KEY=/^arrow/,SPACE_KEY=/^space(bar)?/,ESC_KEY=/^escape$/;function transformKey(a,b){var c="";if(a){var d=a.toLowerCase();" "===d||SPACE_KEY.test(d)?c="space":ESC_KEY.test(d)?c="esc":1==d.length?(!b||KEY_CHAR.test(d))&&(c=d):ARROW_KEY.test(d)?c=d.replace("arrow",""):"multiply"==d?c="*":c=d}return c}function transformKeyIdentifier(a){var b="";return a&&(a in KEY_IDENTIFIER?b=KEY_IDENTIFIER[a]:IDENT_CHAR.test(a)?(a=parseInt(a.replace("U+","0x"),16),b=String.fromCharCode(a).toLowerCase()):b=a.toLowerCase()),b}function transformKeyCode(a){var b="";return+a&&(65<=a&&90>=a?b=String.fromCharCode(32+a):112<=a&&123>=a?b="f"+(a-112+1):48<=a&&57>=a?b=a-48+"":96<=a&&105>=a?b=a-96+"":b=KEY_CODE[a]),b}function normalizedKeyForEvent(a,b){return a.key?transformKey(a.key,b):a.detail&&a.detail.key?transformKey(a.detail.key,b):transformKeyIdentifier(a.keyIdentifier)||transformKeyCode(a.keyCode)||""}function keyComboMatchesEvent(a,b){var c=normalizedKeyForEvent(b,a.hasModifiers);return c===a.key&&(!a.hasModifiers||!!b.shiftKey===!!a.shiftKey&&!!b.ctrlKey===!!a.ctrlKey&&!!b.altKey===!!a.altKey&&!!b.metaKey===!!a.metaKey)}function parseKeyComboString(a){return 1===a.length?{combo:a,key:a,event:"keydown"}:a.split("+").reduce(function(a,b){var c=b.split(":"),d=c[0],e=c[1];return d in MODIFIER_KEYS?(a[MODIFIER_KEYS[d]]=!0,a.hasModifiers=!0):(a.key=d,a.event=e||"keydown"),a},{combo:a.split(":").shift()})}function parseEventString(a){return a.trim().split(" ").map(function(a){return parseKeyComboString(a)})}export const IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:!1},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(a,b){this._imperativeKeyBindings[a]=b,this._prepKeyBindings(),this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={},this._prepKeyBindings(),this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(a,b){for(var c=parseEventString(b),d=0;d<c.length;++d)if(keyComboMatchesEvent(c[d],a))return!0;return!1},_collectKeyBindings:function(){var a=this.behaviors.map(function(a){return a.keyBindings});return-1===a.indexOf(this.keyBindings)&&a.push(this.keyBindings),a},_prepKeyBindings:function(){for(var a in this._keyBindings={},this._collectKeyBindings().forEach(function(a){for(var b in a)this._addKeyBinding(b,a[b])},this),this._imperativeKeyBindings)this._addKeyBinding(a,this._imperativeKeyBindings[a]);for(var b in this._keyBindings)this._keyBindings[b].sort(function(a,b){var c=a[0].hasModifiers,d=b[0].hasModifiers;return c===d?0:c?-1:1})},_addKeyBinding:function(a,b){parseEventString(a).forEach(function(a){this._keyBindings[a.event]=this._keyBindings[a.event]||[],this._keyBindings[a.event].push([a,b])},this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners(),this.isAttached&&this._listenKeyEventListeners()},_listenKeyEventListeners:function(){this.keyEventTarget&&Object.keys(this._keyBindings).forEach(function(a){var b=this._keyBindings[a],c=this._onKeyBindingEvent.bind(this,b);this._boundKeyHandlers.push([this.keyEventTarget,a,c]),this.keyEventTarget.addEventListener(a,c)},this)},_unlistenKeyEventListeners:function(){for(var a,b,c,d;this._boundKeyHandlers.length;)a=this._boundKeyHandlers.pop(),b=a[0],c=a[1],d=a[2],b.removeEventListener(c,d)},_onKeyBindingEvent:function(a,b){if(this.stopKeyboardEventPropagation&&b.stopPropagation(),!b.defaultPrevented)for(var c=0;c<a.length;c++){var d=a[c][0],e=a[c][1];if(keyComboMatchesEvent(d,b)&&(this._triggerKeyHandler(d,e,b),b.defaultPrevented))return}},_triggerKeyHandler:function(a,b,c){var d=Object.create(a);d.keyboardEvent=c;var e=new CustomEvent(a.event,{detail:d,cancelable:!0});this[b].call(this,e),e.defaultPrevented&&c.preventDefault()}};